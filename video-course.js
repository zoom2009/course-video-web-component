console.log("-------- v9 (fixed first play + quality selector) ---------");class VideoCourse extends HTMLElement{static defaultConfig={playerId:"video-player",maxWidth:"800px",maxHeight:"auto",watermarkInterval:4e3,scripts:["https://vjs.zencdn.net/8.6.1/video.min.js","https://cdn.jsdelivr.net/npm/@videojs/http-streaming@3.0.2/dist/videojs-http-streaming.min.js","https://cdn.jsdelivr.net/npm/videojs-quality-selector-hls@1.1.1/dist/videojs-quality-selector-hls.min.js"],playerOptions:{html5:{hls:{enableLowInitialPlaylist:!0,smoothQualityChange:!0,overrideNative:!0}},responsive:!0,fluid:!0,playbackRates:[.5,.75,1,1.25,1.5,2]},watermarkStyle:"position: absolute; top: 10px; right: 10px; color: rgba(255, 255, 255, 0.7); background-color: rgba(0, 0, 0, 0.3); font-size: 1rem; z-index: 9999; padding: 4px 8px; border-radius: 4px; font-weight: bold;"};constructor(){super(),this.attachShadow({mode:"open"}),this._initProperties(),this._bindMethods()}_initProperties(){this._playerId="",this._url="",this._poster="",this._maxWidth=VideoCourse.defaultConfig.maxWidth,this._maxHeight=VideoCourse.defaultConfig.maxHeight,this._watermarkText="",this._player=null,this._watermarkInterval=null,this._scriptsLoaded=!1}_bindMethods(){this._handleResize=this._handleResize.bind(this)}static get observedAttributes(){return["playerid","url","poster","maxwidth","maxheight","dynamicwatermark"]}connectedCallback(){this._loadAttributes(),this._render(),this._loadScripts(),window.addEventListener("resize",this._handleResize)}_loadAttributes(){const t=this.getAttribute("playerid")||this.getAttribute("playerId");this._playerId=t||`video-player-${Math.random().toString(36).slice(2,9)}`,this._url=this.getAttribute("url")||"",this._poster=this.getAttribute("poster")||"",this._maxWidth=this.getAttribute("maxwidth")||this.getAttribute("maxWidth")||VideoCourse.defaultConfig.maxWidth,this._maxHeight=this.getAttribute("maxheight")||this.getAttribute("maxHeight")||VideoCourse.defaultConfig.maxHeight,this._watermarkText=this.getAttribute("dynamicwatermark")||this.getAttribute("dynamicWatermark")||""}disconnectedCallback(){this._cleanup()}_cleanup(){window.removeEventListener("resize",this._handleResize),this._watermarkInterval&&(clearInterval(this._watermarkInterval),this._watermarkInterval=null),this._player&&"function"==typeof this._player.dispose&&(this._player.dispose(),this._player=null)}attributeChangedCallback(t,e,i){e!==i&&(this._updateAttribute(t,i),this.isConnected&&(this._render(),this._player&&"function"==typeof this._player.dispose&&(this._player.dispose(),this._initializePlayer())))}_updateAttribute(t,e){switch(t){case"playerid":this._playerId=e||`video-player-${Math.random().toString(36).slice(2,9)}`;break;case"url":this._url=e||"";break;case"poster":this._poster=e||"";break;case"maxwidth":this._maxWidth=e||VideoCourse.defaultConfig.maxWidth;break;case"maxheight":this._maxHeight=e||VideoCourse.defaultConfig.maxHeight;break;case"dynamicwatermark":this._watermarkText=e||""}}_render(){this.shadowRoot.innerHTML=this._getTemplate()}_getTemplate(){return`\n      <style>\n        @import url('https://vjs.zencdn.net/8.6.1/video-js.css');\n        :host { display: block; width: 100%; }\n        .video-container { width: 100%; max-width: ${this._maxWidth}; max-height: ${this._maxHeight}; margin: 0 auto; position: relative; }\n        .video-js { width: 100%; height: 0; padding-top: 56.25%; position: relative; border-radius: 8px; overflow: hidden; }\n        .video-js .vjs-tech { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }\n        .vjs-big-play-button { background-color: rgba(0, 0, 0, 0.45) !important; border-radius: 50% !important; width: 60px !important; height: 60px !important; }\n      </style>\n      <div class="video-container">\n        <video-js\n          id="${this._playerId}"\n          class="video-js vjs-big-play-centered"\n          controls\n          preload="auto"\n          poster="${this._poster}"\n          playsinline\n          data-setup="{}">\n          <source src="${this._url}" type="application/x-mpegURL">\n        </video-js>\n      </div>\n    `}_loadScripts(){const t=VideoCourse.defaultConfig.scripts;let e=0;const i=()=>{e++,e===t.length&&(this._scriptsLoaded=!0,this._initializePlayer())};t.forEach((t=>{if(document.querySelector(`script[src="${t}"]`))return i();const e=document.createElement("script");e.src=t,e.onload=i,document.head.appendChild(e)}))}_initializePlayer(){if("undefined"==typeof videojs)return setTimeout((()=>this._initializePlayer()),100);const t=this.shadowRoot.querySelector(`#${this._playerId}`);t&&(this._player=videojs(t,VideoCourse.defaultConfig.playerOptions),"function"==typeof this._player.qualitySelectorHls&&this._player.qualitySelectorHls({displayCurrentQuality:!0,vjsIconClass:"vjs-icon-hd"}),this._player.one("play",(()=>this._onFirstPlay())),this._player.ready((()=>{this._setupWatermark(),this._player.paused()||this._onFirstPlay()})))}_setupWatermark(){if(!this._watermarkText)return;const t=document.createElement("div");t.textContent=this._watermarkText,t.style.cssText=VideoCourse.defaultConfig.watermarkStyle,this._player.el().appendChild(t),this._setupWatermarkPositioning(t)}_setupWatermarkPositioning(t){const e=()=>{const e=this._player.el().getBoundingClientRect(),i=e.width-t.offsetWidth,s=e.height-t.offsetHeight,a=Math.max(10,Math.floor(Math.random()*i)),r=Math.max(10,Math.floor(Math.random()*s));t.style.top=`${r}px`,t.style.left=`${a}px`};e(),this._watermarkInterval=setInterval(e,VideoCourse.defaultConfig.watermarkInterval)}_handleResize(){this._player&&this._player.fluid(!0)}play(){this._player&&this._player.play()}pause(){this._player&&this._player.pause()}seekTo(t){this._player&&"number"==typeof t&&t>=0&&this._player.currentTime(t)}callCounterAPI(){const t=this._url.split("/"),e=decodeURIComponent(t[t.length-2]).replace("video-course?name=","");fetch(`https://moonlit-cassowary-25.convex.site/increment-vdo-count?name=${e}`).then((()=>console.log("success counter"))).catch((t=>console.log("error counter:",t)))}_onFirstPlay(){this.callCounterAPI(),console.log("Video played for the first time!"),this.dispatchEvent(new CustomEvent("firstplay",{detail:{player:this._player,currentTime:this._player.currentTime()}}))}}customElements.get("video-course")||customElements.define("video-course",VideoCourse);